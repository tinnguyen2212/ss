<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Âm Dương Việt Nam</title>
    <style>
        /* Giữ nguyên toàn bộ phần style cũ */
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #c0392b;
            --text-dark: #333;
            --text-light: #fff;
            --background-light: #f8f8f8;
            --background-pink: #fadadd;
            --border-color: #ddd;
            --gray-light: #eee;
            --gray-medium: #ccc;
            --danger-color: #c0392b;
            --success-color: #27ae60;
        }

        /* ... (giữ nguyên toàn bộ CSS cũ) */
    </style>
</head>
<body>
    <div class="container">
        <!-- Lịch ngày -->
        <div class="today-calendar">
            <div class="month-nav">
                <button id="prev-day">&lt;</button>
                <div class="month-title" id="solar-month-year">THÁNG 3 NĂM 2025</div>
                <button id="next-day">&gt;</button>
            </div>
            <div class="date-display">
                <div class="date-number" id="current-date">21</div>
                <div class="weekday" id="weekday">THỨ SÁU</div>
            </div>
            <div class="lunar-info">
                <div class="lunar-date">
                    <div class="lunar-day" id="lunar-day">22</div>
                    <div class="lunar-month" id="lunar-month">THÁNG HAI</div>
                    <div class="lunar-year" id="lunar-year">Năm Ất Tỵ</div>
                </div>
                <div class="lunar-details">
                    <div class="detail-row">
                        <span class="detail-label">Ngày:</span>
                        <span id="can-chi-day">Kỷ Sửu</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Tháng:</span>
                        <span id="can-chi-month">Kỷ Mão</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Năm:</span>
                        <span id="can-chi-year">Ất Tỵ</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Tiết khí:</span>
                        <span id="tiet-khi">Xuân phân</span>
                    </div>
                </div>
            </div>
            <div class="time-now" id="current-time">00:00:00</div>
            <div class="sat-su-info">
                <div class="sat-su-row">
                    <span class="sat-su-label">Ngày:</span>
                    <span id="sat-su-day" class="sat-su-inactive">Không phải ngày Sát Sư</span>
                </div>
                <div class="sat-su-row">
                    <span class="sat-su-label">Giờ:</span>
                    <span id="sat-su-hour" class="sat-su-inactive">Không phải giờ Sát Sư</span>
                </div>
            </div>
            <div class="navigation">
                <button id="yesterday">Hôm qua</button>
                <button id="today-button">Hôm nay</button>
                <button id="tomorrow">Ngày mai</button>
            </div>
        </div>

        <!-- Lịch tháng -->
        <div class="month-calendar">
            <div class="month-header">
                <button id="prev-month">&lt;</button>
                <span id="month-title">LỊCH ÂM THÁNG 3/2025</span>
                <button id="next-month">&gt;</button>
            </div>
            <div class="calendar-grid" id="calendar-headers">
                <div class="calendar-header">T2</div>
                <div class="calendar-header">T3</div>
                <div class="calendar-header">T4</div>
                <div class="calendar-header">T5</div>
                <div class="calendar-header">T6</div>
                <div class="calendar-header">T7</div>
                <div class="calendar-header">CN</div>
            </div>
            <div class="calendar-grid" id="calendar-days">
                <!-- Calendar days will be inserted here by JS -->
            </div>
        </div>

        <!-- Phần chuyển đổi lịch -->
        <div class="converter">
            <h2>Chuyển đổi lịch Âm - Dương</h2>
            <div class="tab-buttons">
                <button class="tab-button active" id="solar-to-lunar-tab">Dương lịch sang Âm lịch</button>
                <button class="tab-button" id="lunar-to-solar-tab">Âm lịch sang Dương lịch</button>
            </div>
            <div class="tab-content active" id="solar-to-lunar-content">
                <div class="converter-form">
                    <div class="form-group">
                        <label for="solar-day">Ngày:</label>
                        <input type="number" id="solar-day" min="1" max="31" value="21">
                    </div>
                    <div class="form-group">
                        <label for="solar-month">Tháng:</label>
                        <input type="number" id="solar-month" min="1" max="12" value="3">
                    </div>
                    <div class="form-group">
                        <label for="solar-year">Năm:</label>
                        <input type="number" id="solar-year" min="1900" max="2100" value="2025">
                    </div>
                </div>
                <div class="converter-buttons">
                    <button id="convert-to-lunar">Chuyển đổi sang Âm lịch</button>
                </div>
            </div>
            <div class="tab-content" id="lunar-to-solar-content">
                <div class="converter-form">
                    <div class="form-group">
                        <label for="lunar-day">Ngày:</label>
                        <input type="number" id="lunar-day" min="1" max="30" value="1">
                    </div>
                    <div class="form-group">
                        <label for="lunar-month">Tháng:</label>
                        <input type="number" id="lunar-month" min="1" max="12" value="1">
                    </div>
                    <div class="form-group">
                        <label for="lunar-year">Năm:</label>
                        <input type="number" id="lunar-year" min="1900" max="2100" value="2025">
                    </div>
                    <div class="form-group">
                        <label for="lunar-leap">Tháng nhuận:</label>
                        <select id="lunar-leap">
                            <option value="0">Không</option>
                            <option value="1">Có</option>
                        </select>
                    </div>
                </div>
                <div class="converter-buttons">
                    <button id="convert-to-solar">Chuyển đổi sang Dương lịch</button>
                </div>
            </div>
            <div class="converter-result" id="converter-result">
                <p id="result-text"></p>
            </div>
        </div>
    </div>

    <script>
        // Giữ lại toàn bộ mã JavaScript cũ, nhưng thêm một số chỉnh sửa sau:

        // Thay thế hàm updateTime để cập nhật thời gian thực
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            
            // Định dạng giờ với hai chữ số
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            timeElement.textContent = `${hours}:${minutes}:${seconds}`;
        }

        // Sửa đổi hàm isSatSuDay để chính xác hơn
        function isSatSuDay(dd, mm, yy, lunarMonth) {
            const lunar = convertSolar2Lunar(dd, mm, yy, 7);
            const lunarInfo = {
                day: lunar[0],
                month: lunar[1],
                year: lunar[2]
            };

            // Danh sách ngày Sát Sư (13/1, 11/2, 9/3, 7/4, 5/5, 2/6, 1/7, 29/7, 27/8, 25/9, 23/10, 21/11, 19/12)
            const satSuDays = [
                {month: 1, day: 13},
                {month: 2, day: 11},
                {month: 3, day: 9},
                {month: 4, day: 7},
                {month: 5, day: 5},
                {month: 6, day: 2},
                {month: 7, day: 1},
                {month: 7, day: 29},
                {month: 8, day: 27},
                {month: 9, day: 25},
                {month: 10, day: 23},
                {month: 11, day: 21},
                {month: 12, day: 19}
            ];

            return satSuDays.some(d => 
                d.month === lunarInfo.month && d.day === lunarInfo.day
            );
        }

        // Sửa đổi hàm updateSatSuInfo để chính xác hơn
        function updateSatSuInfo(dd, mm, yy, hour) {
            const lunar = convertSolar2Lunar(dd, mm, yy, 7);
            const lunarMonth = lunar[1];
            
            // Kiểm tra ngày sát sư
            const isSatSuDayFlag = isSatSuDay(dd, mm, yy, lunarMonth);
            
            const satSuDayElement = document.getElementById('sat-su-day');
            if (isSatSuDayFlag) {
                satSuDayElement.textContent = "Ngày Sát Sư";
                satSuDayElement.className = "sat-su-active";
            } else {
                satSuDayElement.textContent = "Không phải ngày Sát Sư";
                satSuDayElement.className = "sat-su-inactive";
            }
            
            // Kiểm tra giờ sát sư
            const satSuHourElement = document.getElementById('sat-su-hour');
            satSuHourElement.textContent = "Không phải giờ Sát Sư";
            satSuHourElement.className = "sat-su-inactive";
        }

        // Vô hiệu hóa chuyển đổi lịch khi là ngày Sát Sư
        function disableConverterOnSatSuDay() {
            const now = new Date();
            const lunar = convertSolar2Lunar(now.getDate(), now.getMonth() + 1, now.getFullYear(), 7);
            
            const convertButtons = document.querySelectorAll('#convert-to-lunar, #convert-to-solar');
            const converterTabs = document.querySelectorAll('.tab-button');
            const navigateButtons = document.querySelectorAll('#yesterday, #tomorrow');
            
            const isSatSuDay = isSatSuDay(now.getDate(), now.getMonth() + 1, now.getFullYear(), lunar[1]);
            
            if (isSatSuDay) {
                convertButtons.forEach(btn => btn.disabled = true);
                converterTabs.forEach(tab => tab.disabled = true);
                navigateButtons.forEach(btn => btn.disabled = true);
            } else {
                convertButtons.forEach(btn => btn.disabled = false);
                converterTabs.forEach(tab => tab.disabled = false);
                navigateButtons.forEach(btn => btn.disabled = false);
            }
        }

        // Chạy các hàm khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo hiển thị với ngày hiện tại
            updateCurrentDate();
            
            // Cập nhật thời gian mỗi giây
            setInterval(updateTime, 1000);
            
            // Kiểm tra và vô hiệu hóa các chức năng nếu là ngày Sát Sư
            disableConverterOnSatSuDay();
        });
    </script>
</body>
</html>
